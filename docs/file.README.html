<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  File: README
  
    &mdash; Cataract - Fast CSS Parser
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" />

  <link rel="stylesheet" href="css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "README";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="file_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: README</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><div id='filecontents'>
<h1 id="label-Cataract">Cataract</h1>

<p>A high-performance CSS parser with C extensions for accurate parsing of complex CSS structures.</p>

<p><a href="https://codecov.io/github/jamescook/cataract"><img src="https://codecov.io/github/jamescook/cataract/graph/badge.svg?token=1PTVV1QTV5" alt="codecov"></a></p>

<h2 id="label-Features">Features</h2>
<ul><li>
<p><strong>C Extension</strong>: Performance-focused C implementation for parsing and serialization</p>
</li><li>
<p><strong>CSS2 Support</strong>: Selectors, combinators, pseudo-classes, pseudo-elements, @media queries</p>
</li><li>
<p><strong>CSS3 Support</strong>: Attribute selectors (<code>^=</code>, <code>$=</code>, <code>*=</code>)</p>
</li><li>
<p><strong>Specificity Calculation</strong>: Automatic CSS specificity computation</p>
</li><li>
<p><strong>Media Query Filtering</strong>: Query rules by media type</p>
</li><li>
<p><strong>Zero Runtime Dependencies</strong>: Pure C extension with no runtime gem dependencies</p>
</li></ul>

<h2 id="label-Installation">Installation</h2>

<p>Add this line to your Gemfile:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_gem'>gem</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>cataract</span><span class='tstring_end'>&#39;</span></span>
</code></pre>

<p>Or install directly:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_gem'>gem</span> <span class='id identifier rubyid_install'>install</span> <span class='id identifier rubyid_cataract'>cataract</span>
</code></pre>

<h3 id="label-Requirements">Requirements</h3>
<ul><li>
<p>Ruby &gt;= 3.1.0</p>
</li></ul>

<h2 id="label-Usage">Usage</h2>

<h3 id="label-Basic+Parsing">Basic Parsing</h3>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>cataract</span><span class='tstring_end'>&#39;</span></span>

<span class='comment'># Parse CSS
</span><span class='id identifier rubyid_parser'>parser</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Cataract.html" title="Cataract (module)">Cataract</a></span></span><span class='op'>::</span><span class='const'>Parser</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='id identifier rubyid_parser'>parser</span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span><span class='lparen'>(</span><span class='heredoc_beg'>&lt;&lt;~CSS</span><span class='rparen'>)</span>
<span class='tstring_content'>  body { margin: 0; padding: 0 }
</span><span class='tstring_content'>
</span><span class='tstring_content'>  @media screen and (min-width: 768px) {
</span><span class='tstring_content'>    .container { width: 750px }
</span><span class='tstring_content'>  }
</span><span class='tstring_content'>
</span><span class='tstring_content'>  div.header &gt; h1:hover { color: blue }
</span><span class='heredoc_end'>CSS
</span>
<span class='comment'># Query selectors
</span><span class='id identifier rubyid_parser'>parser</span><span class='period'>.</span><span class='id identifier rubyid_selectors'>selectors</span>
<span class='comment'># =&gt; [&quot;body&quot;, &quot;.container&quot;, &quot;div.header &gt; h1:hover&quot;]
</span>
<span class='comment'># Find declarations by selector
</span><span class='id identifier rubyid_parser'>parser</span><span class='period'>.</span><span class='id identifier rubyid_find_by_selector'>find_by_selector</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>body</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='comment'># =&gt; [&quot;margin: 0;&quot;, &quot;padding: 0;&quot;]
</span>
<span class='comment'># Filter by media type
</span><span class='id identifier rubyid_parser'>parser</span><span class='period'>.</span><span class='id identifier rubyid_find_by_selector'>find_by_selector</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>.container</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:screen</span><span class='rparen'>)</span>
<span class='comment'># =&gt; [&quot;width: 750px;&quot;]
</span>
<span class='comment'># Get specificity
</span><span class='id identifier rubyid_parser'>parser</span><span class='period'>.</span><span class='id identifier rubyid_each_selector'>each_selector</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_selector'>selector</span><span class='comma'>,</span> <span class='id identifier rubyid_declarations'>declarations</span><span class='comma'>,</span> <span class='id identifier rubyid_specificity'>specificity</span><span class='op'>|</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_selector'>selector</span><span class='embexpr_end'>}</span><span class='tstring_content'>: specificity=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_specificity'>specificity</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
<span class='comment'># body: specificity=1
</span><span class='comment'># .container: specificity=10
</span><span class='comment'># div.header &gt; h1:hover: specificity=23
</span>
<span class='comment'># Count rules
</span><span class='id identifier rubyid_parser'>parser</span><span class='period'>.</span><span class='id identifier rubyid_rules_count'>rules_count</span>
<span class='comment'># =&gt; 3
</span></code></pre>

<h3 id="label-Advanced+Filtering+with+each_selector">Advanced Filtering with each_selector</h3>

<p>The <code>Stylesheet#each_selector</code> method provides powerful filtering capabilities for CSS analysis:</p>

<pre class="code ruby"><code class="ruby">sheet = Cataract.parse_css(css)

# Find high-specificity selectors (potential refactoring targets)
sheet.each_selector(specificity: 100..) do |selector, declarations, specificity, media_types|
  puts &quot;High specificity: #{selector} (#{specificity})&quot;
end

# Find all selectors that define a color property
sheet.each_selector(property: &#39;color&#39;) do |selector, declarations, specificity, media_types|
  puts &quot;#{selector} defines color&quot;
end

# Find all positioned elements
sheet.each_selector(property: &#39;position&#39;, property_value: &#39;relative&#39;) do |selector, declarations, specificity, media_types|
  puts &quot;#{selector} is relatively positioned&quot;
end

# Find any property with a specific value (useful for finding typos or deprecated values)
sheet.each_selector(property_value: &#39;relative&#39;) do |selector, declarations, specificity, media_types|
  puts &quot;#{selector} uses value &#39;relative&#39;&quot;
end

# Combine filters for complex queries
sheet.each_selector(property: &#39;z-index&#39;, specificity: 100.., media: :screen) do |selector, declarations, specificity, media_types|
  puts &quot;High-specificity z-index usage in screen media: #{selector}&quot;
end

# Filter by specificity ranges
sheet.each_selector(specificity: 10..100) { |sel, decls, spec, media| ... }  # Class to ID range
sheet.each_selector(specificity: ..10) { |sel, decls, spec, media| ... }     # Low specificity (&lt;= 10)
</code></pre>

<p>See <a href="BENCHMARKS_md.html">BENCHMARKS.md</a> for detailed performance comparisons.</p>

<h2 id="label-CSS+Support">CSS Support</h2>

<p>Cataract aims to support all CSS specifications including: - <strong>Selectors</strong>: All CSS2/CSS3 selectors (type, class, ID, attribute, pseudo-classes, pseudo-elements, combinators) - <strong>At-rules</strong>: <code>@media</code>, <code>@font-face</code>, <code>@keyframes</code>, <code>@supports</code>, <code>@page</code>, <code>@layer</code>, <code>@container</code>, <code>@property</code>, <code>@scope</code>, <code>@counter-style</code> - <strong>Media Queries</strong>: Full support including nested queries and media features - <strong>Special syntax</strong>: Data URIs, <code>calc()</code>, <code>url()</code>, CSS functions with parentheses - <strong>!important</strong>: Full support with correct cascade behavior</p>

<h3 id="label-40import+Support"><code>@import</code> Support</h3>

<p><code>@import</code> statements can be resolved with security controls:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># Disabled by default
</span><span class='id identifier rubyid_sheet'>sheet</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Cataract.html" title="Cataract (module)">Cataract</a></span></span><span class='period'>.</span><span class='id identifier rubyid_parse_css'><span class='object_link'><a href="Cataract.html#parse_css-class_method" title="Cataract.parse_css (method)">parse_css</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_css'>css</span><span class='rparen'>)</span>  <span class='comment'># @import statements are ignored
</span>
<span class='comment'># Enable with safe defaults (HTTPS only, .css files only, max depth 5)
</span><span class='id identifier rubyid_sheet'>sheet</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Cataract.html" title="Cataract (module)">Cataract</a></span></span><span class='period'>.</span><span class='id identifier rubyid_parse_css'><span class='object_link'><a href="Cataract.html#parse_css-class_method" title="Cataract.parse_css (method)">parse_css</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_css'>css</span><span class='comma'>,</span> <span class='label'>imports:</span> <span class='kw'>true</span><span class='rparen'>)</span>

<span class='comment'># Custom options for full control
</span><span class='id identifier rubyid_sheet'>sheet</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Cataract.html" title="Cataract (module)">Cataract</a></span></span><span class='period'>.</span><span class='id identifier rubyid_parse_css'><span class='object_link'><a href="Cataract.html#parse_css-class_method" title="Cataract.parse_css (method)">parse_css</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_css'>css</span><span class='comma'>,</span> <span class='label'>imports:</span> <span class='lbrace'>{</span>
  <span class='label'>allowed_schemes:</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>https</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>file</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='comma'>,</span>   <span class='comment'># Default: [&#39;https&#39;]
</span>  <span class='label'>extensions:</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>css</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='comma'>,</span>                   <span class='comment'># Default: [&#39;css&#39;]
</span>  <span class='label'>max_depth:</span> <span class='int'>3</span><span class='comma'>,</span>                          <span class='comment'># Default: 5
</span>  <span class='label'>timeout:</span> <span class='int'>10</span><span class='comma'>,</span>                           <span class='comment'># Default: 10 seconds
</span>  <span class='label'>follow_redirects:</span> <span class='kw'>true</span>                 <span class='comment'># Default: true
</span><span class='rbrace'>}</span><span class='rparen'>)</span>
</code></pre>

<p><strong>Security note</strong>: Import resolution includes protections against: - Unauthorized schemes (file://, data://, etc.) - Non-CSS file extensions - Circular references - Excessive nesting depth</p>

<h2 id="label-Development">Development</h2>

<pre class="code ruby"><code class="ruby"><span class='comment'># Install dependencies
</span><span class='id identifier rubyid_bundle'>bundle</span> <span class='id identifier rubyid_install'>install</span>

<span class='comment'># Compile the C extension
</span><span class='id identifier rubyid_rake'>rake</span> <span class='id identifier rubyid_compile'>compile</span>

<span class='comment'># Run tests
</span><span class='id identifier rubyid_rake'>rake</span> <span class='id identifier rubyid_test'>test</span>

<span class='comment'># Run benchmarks
</span><span class='id identifier rubyid_rake'>rake</span> <span class='id identifier rubyid_benchmark'>benchmark</span>
</code></pre>

<h2 id="label-How+It+Works">How It Works</h2>

<p>Cataract uses a high-performance C implementation for CSS parsing and serialization. The parser processes CSS into an internal data structure organized by media queries:</p>

<pre class="code ruby"><code class="ruby">{
  # Media query string =&gt; group info
  &quot;(min-width: 768px)&quot; =&gt; {
    media_types: [:screen],  # Array of applicable media types
    rules: [...]             # Array of Rule structs for this media query
  },
  nil =&gt; {
    media_types: [:all],     # Rules with no media query
    rules: [...]
  }
}
</code></pre>

<p>Each <code>Rule</code> is a struct containing: - <code>selector</code>: The CSS selector string - <code>declarations</code>: Array of <code>Declarations::Value</code> structs (property, value, important flag) - <code>specificity</code>: Calculated CSS specificity (cached)</p>

<p>Implementation details: - <strong>C implementation</strong>: Critical paths implemented in C (parsing, merging, serialization) - <strong>Efficient media query handling</strong>: Rules grouped by media query for O(1) lookups - <strong>Memory efficient</strong>: Minimal allocations, reuses string buffers where possible - <strong>Comprehensive</strong>: Handles complex CSS including nested media queries, data URIs, calc() functions</p>

<h2 id="label-Development+Notes">Development Notes</h2>

<p>Significant portions of this codebase were generated with assistance from <a href="https://claude.com/claude-code">Claude Code</a>, including the benchmark infrastructure, test suite, and documentation generation system.</p>

<h2 id="label-License">License</h2>

<p>MIT</p>

<h2 id="label-Contributing">Contributing</h2>

<p>Bug reports and pull requests are welcome on GitHub at <a href="https://github.com/jamescook/cataract">github.com/jamescook/cataract</a>.</p>
</div></div>

      <div id="footer">
  Generated on Tue Nov  4 13:33:24 2025 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.37 (ruby-3.4.5).
</div>

    </div>
  </body>
</html>