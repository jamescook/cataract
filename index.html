<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  File: README
  
    &mdash; Cataract - Fast CSS Parser
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" />

  <link rel="stylesheet" href="css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "README";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: README</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><div id='filecontents'>
<h1 id="label-Cataract">Cataract</h1>

<p>A performant CSS parser for accurate parsing of complex CSS structures.</p>

<p><a href="https://codecov.io/github/jamescook/cataract"><img src="https://codecov.io/github/jamescook/cataract/graph/badge.svg?token=1PTVV1QTV5" alt="codecov"></a></p>

<p><strong>Documentation[https://jamescook.github.io/cataract/]</strong></p>

<h2 id="label-Features">Features</h2>
<ul><li>
<p><strong>C Extension</strong>: Performance-focused C implementation for parsing and serialization</p>
</li><li>
<p><strong>CSS2 Support</strong>: Selectors, combinators, pseudo-classes, pseudo-elements, @media queries</p>
</li><li>
<p><strong>CSS3 Support</strong>: Attribute selectors (<code>^=</code>, <code>$=</code>, <code>*=</code>)</p>
</li><li>
<p><strong>CSS Color Level 4</strong>: Parses and preserves modern color formats (hex, rgb, hsl, hwb, oklab, oklch, lab, lch, named colors). Optional color conversion utility for transforming between formats.</p>
</li><li>
<p><strong>Specificity Calculation</strong>: Automatic CSS specificity computation</p>
</li><li>
<p><strong>Media Query Filtering</strong>: Query rules by media type</p>
</li><li>
<p><strong>Zero Runtime Dependencies</strong>: Pure C extension with no runtime gem dependencies</p>
</li></ul>

<h2 id="label-Installation">Installation</h2>

<p>Add this line to your Gemfile:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_gem'>gem</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>cataract</span><span class='tstring_end'>&#39;</span></span>
</code></pre>

<p>Or install directly:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_gem'>gem</span> <span class='id identifier rubyid_install'>install</span> <span class='id identifier rubyid_cataract'>cataract</span>
</code></pre>

<h3 id="label-Requirements">Requirements</h3>
<ul><li>
<p>Ruby &gt;= 3.1.0</p>
</li></ul>

<h2 id="label-Usage">Usage</h2>

<h3 id="label-Basic+Parsing">Basic Parsing</h3>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>cataract</span><span class='tstring_end'>&#39;</span></span>

<span class='comment'># Parse CSS
</span><span class='id identifier rubyid_sheet'>sheet</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Cataract.html" title="Cataract (module)">Cataract</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Cataract/Stylesheet.html" title="Cataract::Stylesheet (class)">Stylesheet</a></span></span><span class='period'>.</span><span class='id identifier rubyid_parse'><span class='object_link'><a href="Cataract/Stylesheet.html#parse-class_method" title="Cataract::Stylesheet.parse (method)">parse</a></span></span><span class='lparen'>(</span><span class='heredoc_beg'>&lt;&lt;~CSS</span><span class='rparen'>)</span>
<span class='tstring_content'>  body { margin: 0; padding: 0 }
</span><span class='tstring_content'>
</span><span class='tstring_content'>  @media screen and (min-width: 768px) {
</span><span class='tstring_content'>    .container { width: 750px }
</span><span class='tstring_content'>  }
</span><span class='tstring_content'>
</span><span class='tstring_content'>  div.header &gt; h1:hover { color: blue }
</span><span class='heredoc_end'>CSS
</span>
<span class='comment'># Get all selectors
</span><span class='id identifier rubyid_sheet'>sheet</span><span class='period'>.</span><span class='id identifier rubyid_selectors'>selectors</span>
<span class='comment'># =&gt; [&quot;body&quot;, &quot;.container&quot;, &quot;div.header &gt; h1:hover&quot;]
</span>
<span class='comment'># Get all rules
</span><span class='id identifier rubyid_sheet'>sheet</span><span class='period'>.</span><span class='id identifier rubyid_rules'>rules</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_rule'>rule</span><span class='op'>|</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_rule'>rule</span><span class='period'>.</span><span class='id identifier rubyid_selector'>selector</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_rule'>rule</span><span class='period'>.</span><span class='id identifier rubyid_declarations'>declarations</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='embexpr_end'>}</span><span class='tstring_content'> declarations</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>

<span class='comment'># Access specific rule
</span><span class='id identifier rubyid_body_rule'>body_rule</span> <span class='op'>=</span> <span class='id identifier rubyid_sheet'>sheet</span><span class='period'>.</span><span class='id identifier rubyid_rules'>rules</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
<span class='id identifier rubyid_body_rule'>body_rule</span><span class='period'>.</span><span class='id identifier rubyid_selector'>selector</span>       <span class='comment'># =&gt; &quot;body&quot;
</span><span class='id identifier rubyid_body_rule'>body_rule</span><span class='period'>.</span><span class='id identifier rubyid_specificity'>specificity</span>    <span class='comment'># =&gt; 1
</span><span class='id identifier rubyid_body_rule'>body_rule</span><span class='period'>.</span><span class='id identifier rubyid_declarations'>declarations</span>   <span class='comment'># =&gt; [#&lt;Declaration property=&quot;margin&quot; value=&quot;0&quot;&gt;, ...]
</span>
<span class='comment'># Count rules
</span><span class='id identifier rubyid_sheet'>sheet</span><span class='period'>.</span><span class='id identifier rubyid_rules_count'>rules_count</span>
<span class='comment'># =&gt; 3
</span>
<span class='comment'># Serialize back to CSS
</span><span class='id identifier rubyid_sheet'>sheet</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
<span class='comment'># =&gt; &quot;body { margin: 0; padding: 0; } @media screen and (min-width: 768px) { .container { width: 750px; } } ...&quot;
</span></code></pre>

<h3 id="label-Advanced+Filtering+with+Enumerable">Advanced Filtering with Enumerable</h3>

<p><code>Cataracy::Stylesheet</code> implements <code>Enumerable</code>, providing standard Ruby collection methods plus chainable scopes:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_sheet'>sheet</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Cataract.html" title="Cataract (module)">Cataract</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Cataract/Stylesheet.html" title="Cataract::Stylesheet (class)">Stylesheet</a></span></span><span class='period'>.</span><span class='id identifier rubyid_parse'><span class='object_link'><a href="Cataract/Stylesheet.html#parse-class_method" title="Cataract::Stylesheet.parse (method)">parse</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_css'>css</span><span class='rparen'>)</span>

<span class='comment'># Basic Enumerable methods work
</span><span class='id identifier rubyid_sheet'>sheet</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:selector</span><span class='rparen'>)</span>                    <span class='comment'># =&gt; [&quot;body&quot;, &quot;.container&quot;, &quot;div.header &gt; h1:hover&quot;]
</span><span class='id identifier rubyid_sheet'>sheet</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:selector?</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span>          <span class='comment'># =&gt; Count only selector-based rules (excludes @keyframes, etc.)
</span><span class='id identifier rubyid_sheet'>sheet</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_r'>r</span><span class='op'>|</span> <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_selector'>selector</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>body</span><span class='tstring_end'>&#39;</span></span> <span class='rbrace'>}</span>  <span class='comment'># =&gt; First rule matching selector
</span>
<span class='comment'># Filter to selector-based rules only (excludes at-rules like @keyframes, @font-face)
</span><span class='id identifier rubyid_sheet'>sheet</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:selector?</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_rule'>rule</span><span class='op'>|</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_rule'>rule</span><span class='period'>.</span><span class='id identifier rubyid_selector'>selector</span><span class='embexpr_end'>}</span><span class='tstring_content'>: specificity </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_rule'>rule</span><span class='period'>.</span><span class='id identifier rubyid_specificity'>specificity</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>

<span class='comment'># Filter by media query (returns chainable scope)
</span><span class='id identifier rubyid_sheet'>sheet</span><span class='period'>.</span><span class='id identifier rubyid_with_media'>with_media</span><span class='lparen'>(</span><span class='symbol'>:print</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_rule'>rule</span><span class='op'>|</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Print rule: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_rule'>rule</span><span class='period'>.</span><span class='id identifier rubyid_selector'>selector</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>

<span class='comment'># Filter by selector (returns chainable scope)
</span><span class='id identifier rubyid_sheet'>sheet</span><span class='period'>.</span><span class='id identifier rubyid_with_selector'>with_selector</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>body</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_rule'>rule</span><span class='op'>|</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Body rule has </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_rule'>rule</span><span class='period'>.</span><span class='id identifier rubyid_declarations'>declarations</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='embexpr_end'>}</span><span class='tstring_content'> declarations</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>

<span class='comment'># Filter by specificity (returns chainable scope)
</span><span class='id identifier rubyid_sheet'>sheet</span><span class='period'>.</span><span class='id identifier rubyid_with_specificity'>with_specificity</span><span class='lparen'>(</span><span class='int'>100</span><span class='op'>..</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_rule'>rule</span><span class='op'>|</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>High specificity: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_rule'>rule</span><span class='period'>.</span><span class='id identifier rubyid_selector'>selector</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_rule'>rule</span><span class='period'>.</span><span class='id identifier rubyid_specificity'>specificity</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>

<span class='comment'># Chain filters together
</span><span class='id identifier rubyid_sheet'>sheet</span><span class='period'>.</span><span class='id identifier rubyid_with_media'>with_media</span><span class='lparen'>(</span><span class='symbol'>:screen</span><span class='rparen'>)</span>
     <span class='period'>.</span><span class='id identifier rubyid_with_specificity'>with_specificity</span><span class='lparen'>(</span><span class='int'>50</span><span class='op'>..</span><span class='int'>200</span><span class='rparen'>)</span>
     <span class='period'>.</span><span class='id identifier rubyid_select'>select</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:selector?</span><span class='rparen'>)</span>
     <span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:selector</span><span class='rparen'>)</span>
<span class='comment'># =&gt; [&quot;#header .nav&quot;, &quot;.sidebar &gt; ul li&quot;]
</span>
<span class='comment'># Find all rules with a specific property
</span><span class='id identifier rubyid_sheet'>sheet</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:selector?</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_rule'>rule</span><span class='op'>|</span>
  <span class='id identifier rubyid_rule'>rule</span><span class='period'>.</span><span class='id identifier rubyid_declarations'>declarations</span><span class='period'>.</span><span class='id identifier rubyid_any?'>any?</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_d'>d</span><span class='op'>|</span> <span class='id identifier rubyid_d'>d</span><span class='period'>.</span><span class='id identifier rubyid_property'>property</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>color</span><span class='tstring_end'>&#39;</span></span> <span class='rbrace'>}</span>
<span class='kw'>end</span>

<span class='comment'># Find high-specificity selectors (potential refactoring targets)
</span><span class='id identifier rubyid_sheet'>sheet</span><span class='period'>.</span><span class='id identifier rubyid_with_specificity'>with_specificity</span><span class='lparen'>(</span><span class='int'>100</span><span class='op'>..</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:selector?</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_rule'>rule</span><span class='op'>|</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Refactor candidate: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_rule'>rule</span><span class='period'>.</span><span class='id identifier rubyid_selector'>selector</span><span class='embexpr_end'>}</span><span class='tstring_content'> (specificity: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_rule'>rule</span><span class='period'>.</span><span class='id identifier rubyid_specificity'>specificity</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>

<span class='comment'># Find positioned elements in screen media
</span><span class='id identifier rubyid_sheet'>sheet</span><span class='period'>.</span><span class='id identifier rubyid_with_media'>with_media</span><span class='lparen'>(</span><span class='symbol'>:screen</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_rule'>rule</span><span class='op'>|</span>
  <span class='id identifier rubyid_rule'>rule</span><span class='period'>.</span><span class='id identifier rubyid_selector?'>selector?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_rule'>rule</span><span class='period'>.</span><span class='id identifier rubyid_declarations'>declarations</span><span class='period'>.</span><span class='id identifier rubyid_any?'>any?</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_d'>d</span><span class='op'>|</span>
    <span class='id identifier rubyid_d'>d</span><span class='period'>.</span><span class='id identifier rubyid_property'>property</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>position</span><span class='tstring_end'>&#39;</span></span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_d'>d</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>relative</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='comment'># Terminal operations force evaluation
</span><span class='id identifier rubyid_sheet'>sheet</span><span class='period'>.</span><span class='id identifier rubyid_with_media'>with_media</span><span class='lparen'>(</span><span class='symbol'>:print</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span>         <span class='comment'># =&gt; Array of rules
</span><span class='id identifier rubyid_sheet'>sheet</span><span class='period'>.</span><span class='id identifier rubyid_with_selector'>with_selector</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>.header</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span>   <span class='comment'># =&gt; 3
</span><span class='id identifier rubyid_sheet'>sheet</span><span class='period'>.</span><span class='id identifier rubyid_with_specificity'>with_specificity</span><span class='lparen'>(</span><span class='int'>10</span><span class='op'>..</span><span class='int'>50</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='comment'># =&gt; false
</span></code></pre>

<p>See <a href="BENCHMARKS_md.html">BENCHMARKS.md</a> for detailed performance comparisons.</p>

<h2 id="label-CSS+Support">CSS Support</h2>

<p>Cataract aims to support all CSS specifications including: - <strong>Selectors</strong>: All CSS2/CSS3 selectors (type, class, ID, attribute, pseudo-classes, pseudo-elements, combinators) - <strong>At-rules</strong>: <code>@media</code>, <code>@font-face</code>, <code>@keyframes</code>, <code>@supports</code>, <code>@page</code>, <code>@layer</code>, <code>@container</code>, <code>@property</code>, <code>@scope</code>, <code>@counter-style</code> - <strong>Media Queries</strong>: Full support including nested queries and media features - <strong>Special syntax</strong>: Data URIs, <code>calc()</code>, <code>url()</code>, CSS functions with parentheses - <strong>!important</strong>: Full support with correct cascade behavior</p>

<h3 id="label-Color+Conversion">Color Conversion</h3>

<p>Cataract supports converting colors between multiple CSS color formats with high precision.</p>

<p><strong>Note:</strong> Color conversion is an optional extension. Load it explicitly to reduce memory footprint:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>cataract</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>cataract/color_conversion</span><span class='tstring_end'>&#39;</span></span>

<span class='comment'># Convert hex to RGB
</span><span class='id identifier rubyid_sheet'>sheet</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Cataract.html" title="Cataract (module)">Cataract</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Cataract/Stylesheet.html" title="Cataract::Stylesheet (class)">Stylesheet</a></span></span><span class='period'>.</span><span class='id identifier rubyid_parse'><span class='object_link'><a href="Cataract/Stylesheet.html#parse-class_method" title="Cataract::Stylesheet.parse (method)">parse</a></span></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>.button { color: #ff0000; background: #00ff00; }</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_sheet'>sheet</span><span class='period'>.</span><span class='id identifier rubyid_convert_colors!'>convert_colors!</span><span class='lparen'>(</span><span class='label'>from:</span> <span class='symbol'>:hex</span><span class='comma'>,</span> <span class='label'>to:</span> <span class='symbol'>:rgb</span><span class='rparen'>)</span>
<span class='id identifier rubyid_sheet'>sheet</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
<span class='comment'># =&gt; &quot;.button { color: rgb(255 0 0); background: rgb(0 255 0); }&quot;
</span>
<span class='comment'># Convert RGB to HSL for easier color manipulation
</span><span class='id identifier rubyid_sheet'>sheet</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Cataract.html" title="Cataract (module)">Cataract</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Cataract/Stylesheet.html" title="Cataract::Stylesheet (class)">Stylesheet</a></span></span><span class='period'>.</span><span class='id identifier rubyid_parse'><span class='object_link'><a href="Cataract/Stylesheet.html#parse-class_method" title="Cataract::Stylesheet.parse (method)">parse</a></span></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>.card { color: rgb(255, 128, 0); }</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_sheet'>sheet</span><span class='period'>.</span><span class='id identifier rubyid_convert_colors!'>convert_colors!</span><span class='lparen'>(</span><span class='label'>from:</span> <span class='symbol'>:rgb</span><span class='comma'>,</span> <span class='label'>to:</span> <span class='symbol'>:hsl</span><span class='rparen'>)</span>
<span class='id identifier rubyid_sheet'>sheet</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
<span class='comment'># =&gt; &quot;.card { color: hsl(30, 100%, 50%); }&quot;
</span>
<span class='comment'># Convert to Oklab for perceptually uniform colors
</span><span class='id identifier rubyid_sheet'>sheet</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Cataract.html" title="Cataract (module)">Cataract</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Cataract/Stylesheet.html" title="Cataract::Stylesheet (class)">Stylesheet</a></span></span><span class='period'>.</span><span class='id identifier rubyid_parse'><span class='object_link'><a href="Cataract/Stylesheet.html#parse-class_method" title="Cataract::Stylesheet.parse (method)">parse</a></span></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>.gradient { background: linear-gradient(#ff0000, #0000ff); }</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_sheet'>sheet</span><span class='period'>.</span><span class='id identifier rubyid_convert_colors!'>convert_colors!</span><span class='lparen'>(</span><span class='label'>to:</span> <span class='symbol'>:oklab</span><span class='rparen'>)</span>
<span class='id identifier rubyid_sheet'>sheet</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
<span class='comment'># =&gt; &quot;.gradient { background: linear-gradient(oklab(0.6280 0.2249 0.1258), oklab(0.4520 -0.0325 -0.3115)); }&quot;
</span>
<span class='comment'># Auto-detect source format and convert all colors
</span><span class='id identifier rubyid_sheet'>sheet</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Cataract.html" title="Cataract (module)">Cataract</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Cataract/Stylesheet.html" title="Cataract::Stylesheet (class)">Stylesheet</a></span></span><span class='period'>.</span><span class='id identifier rubyid_parse'><span class='object_link'><a href="Cataract/Stylesheet.html#parse-class_method" title="Cataract::Stylesheet.parse (method)">parse</a></span></span><span class='lparen'>(</span><span class='heredoc_beg'>&lt;&lt;~CSS</span><span class='rparen'>)</span>
<span class='tstring_content'>  .mixed {
</span><span class='tstring_content'>    color: #ff0000;
</span><span class='tstring_content'>    background: rgb(0, 255, 0);
</span><span class='tstring_content'>    border-color: hsl(240, 100%, 50%);
</span><span class='tstring_content'>  }
</span><span class='heredoc_end'>CSS
</span><span class='id identifier rubyid_sheet'>sheet</span><span class='period'>.</span><span class='id identifier rubyid_convert_colors!'>convert_colors!</span><span class='lparen'>(</span><span class='label'>to:</span> <span class='symbol'>:hex</span><span class='rparen'>)</span>  <span class='comment'># Converts all formats to hex
</span></code></pre>

<h4 id="label-Supported+Color+Formats">Supported Color Formats</h4>

<table role="table">
<thead>
<tr>
<th>Format</th>
<th>From</th>
<th>To</th>
<th>Alpha</th>
<th>Example</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>hex</strong></td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>‘#ff0000`, `#f00`, `#ff000080`</td>
<td>3, 6, or 8 digit hex</td>
</tr>
<tr>
<td><strong>rgb</strong></td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>‘rgb(255 0 0)`, `rgb(255, 0, 0)`</td>
<td>Modern &amp; legacy syntax</td>
</tr>
<tr>
<td><strong>hsl</strong></td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>‘hsl(0, 100%, 50%)`</td>
<td>Hue, saturation, lightness</td>
</tr>
<tr>
<td><strong>hwb</strong></td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>‘hwb(0 0% 0%)`</td>
<td>Hue, whiteness, blackness</td>
</tr>
<tr>
<td><strong>oklab</strong></td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>‘oklab(0.628 0.225 0.126)`</td>
<td>Perceptually uniform color space</td>
</tr>
<tr>
<td><strong>oklch</strong></td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>‘oklch(0.628 0.258 29.2)`</td>
<td>Cylindrical Oklab (LCh)</td>
</tr>
<tr>
<td><strong>lab</strong></td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>‘lab(53.2% 80.1 67.2)`</td>
<td>CIE L*a*b* color space (D50)</td>
</tr>
<tr>
<td><strong>lch</strong></td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>‘lch(53.2% 104.5 40)`</td>
<td>Cylindrical Lab (polar coordinates)</td>
</tr>
<tr>
<td><strong>named</strong></td>
<td>✓</td>
<td>✓</td>
<td>–</td>
<td>‘red`, `blue`, `rebeccapurple`</td>
<td>147 CSS named colors</td>
</tr>
<tr>
<td>**color()**</td>
<td>–</td>
<td>–</td>
<td>–</td>
<td>‘color(display-p3 1 0 0)`</td>
<td>Absolute color spaces (planned)</td>
</tr>
</tbody>
</table>

<p><strong>Format aliases:</strong> - <code>:rgba</code> → uses <code>rgb()</code> syntax with alpha - <code>:hsla</code> → uses <code>hsl()</code> syntax with alpha - <code>:hwba</code> → uses <code>hwb()</code> syntax with alpha</p>

<p><strong>Limitations:</strong> - Math functions (<code>calc()</code>, <code>min()</code>, <code>max()</code>, <code>clamp()</code>) are not evaluated and will be preserved unchanged - CSS Color Level 5 features (<code>none</code>, <code>infinity</code>, relative color syntax with <code>from</code>) are preserved but not converted - Unknown or future color functions are passed through unchanged</p>

<h3 id="label-40import+Support"><code>@import</code> Support</h3>

<p><code>@import</code> statements can be resolved with security controls:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># Disabled by default
</span><span class='id identifier rubyid_sheet'>sheet</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Cataract.html" title="Cataract (module)">Cataract</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Cataract/Stylesheet.html" title="Cataract::Stylesheet (class)">Stylesheet</a></span></span><span class='period'>.</span><span class='id identifier rubyid_parse'><span class='object_link'><a href="Cataract/Stylesheet.html#parse-class_method" title="Cataract::Stylesheet.parse (method)">parse</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_css'>css</span><span class='rparen'>)</span>  <span class='comment'># @import statements are ignored
</span>
<span class='comment'># Enable with safe defaults (HTTPS only, .css files only, max depth 5)
</span><span class='id identifier rubyid_sheet'>sheet</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Cataract.html" title="Cataract (module)">Cataract</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Cataract/Stylesheet.html" title="Cataract::Stylesheet (class)">Stylesheet</a></span></span><span class='period'>.</span><span class='id identifier rubyid_parse'><span class='object_link'><a href="Cataract/Stylesheet.html#parse-class_method" title="Cataract::Stylesheet.parse (method)">parse</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_css'>css</span><span class='comma'>,</span> <span class='label'>import:</span> <span class='kw'>true</span><span class='rparen'>)</span>

<span class='comment'># Custom options for full control
</span><span class='id identifier rubyid_sheet'>sheet</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Cataract.html" title="Cataract (module)">Cataract</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Cataract/Stylesheet.html" title="Cataract::Stylesheet (class)">Stylesheet</a></span></span><span class='period'>.</span><span class='id identifier rubyid_parse'><span class='object_link'><a href="Cataract/Stylesheet.html#parse-class_method" title="Cataract::Stylesheet.parse (method)">parse</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_css'>css</span><span class='comma'>,</span> <span class='label'>import:</span> <span class='lbrace'>{</span>
  <span class='label'>allowed_schemes:</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>https</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>file</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='comma'>,</span>   <span class='comment'># Default: [&#39;https&#39;]
</span>  <span class='label'>extensions:</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>css</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='comma'>,</span>                   <span class='comment'># Default: [&#39;css&#39;]
</span>  <span class='label'>max_depth:</span> <span class='int'>3</span><span class='comma'>,</span>                          <span class='comment'># Default: 5
</span>  <span class='label'>timeout:</span> <span class='int'>10</span><span class='comma'>,</span>                           <span class='comment'># Default: 10 seconds
</span>  <span class='label'>follow_redirects:</span> <span class='kw'>true</span>                 <span class='comment'># Default: true
</span><span class='rbrace'>}</span><span class='rparen'>)</span>
</code></pre>

<p><strong>Security note</strong>: Import resolution includes protections against: - Unauthorized schemes (file://, data://, etc.) - Non-CSS file extensions - Circular references - Excessive nesting depth</p>

<h2 id="label-Development">Development</h2>

<pre class="code ruby"><code class="ruby"><span class='comment'># Install dependencies
</span><span class='id identifier rubyid_bundle'>bundle</span> <span class='id identifier rubyid_install'>install</span>

<span class='comment'># Compile the C extension
</span><span class='id identifier rubyid_rake'>rake</span> <span class='id identifier rubyid_compile'>compile</span>

<span class='comment'># Run tests
</span><span class='id identifier rubyid_rake'>rake</span> <span class='id identifier rubyid_test'>test</span>

<span class='comment'># Run benchmarks
</span><span class='id identifier rubyid_rake'>rake</span> <span class='id identifier rubyid_benchmark'>benchmark</span>

<span class='comment'># Run fuzzer to test parser robustness
</span><span class='id identifier rubyid_rake'>rake</span> <span class='id identifier rubyid_fuzz'>fuzz</span>                      <span class='comment'># 10,000 iterations (default)
</span><span class='id identifier rubyid_rake'>rake</span> <span class='id identifier rubyid_fuzz'>fuzz</span> <span class='const'>ITERATIONS</span><span class='op'>=</span><span class='int'>100000</span>    <span class='comment'># Custom iteration count
</span></code></pre>

<p><strong>Fuzzer</strong>: Generates random CSS input to test parser robustness against malformed or edge-case CSS. Helps catch crashes, memory leaks, and parsing edge cases.</p>

<h2 id="label-How+It+Works">How It Works</h2>

<p>Cataract uses a high-performance C implementation for CSS parsing and serialization.</p>

<p>Each <code>Rule</code> is a struct containing: - <code>id</code>: Integer ID (position in rules array) - <code>selector</code>: The CSS selector string - <code>declarations</code>: Array of <code>Declaration</code> structs (property, value, important flag) - <code>specificity</code>: Calculated CSS specificity (cached)</p>

<p>Implementation details: - <strong>C implementation</strong>: Critical paths implemented in C (parsing, merging, serialization) - <strong>Flat rule array</strong>: All rules stored in a single array, preserving source order - <strong>Efficient media query handling</strong>: O(1) lookup via internal media index - <strong>Memory efficient</strong>: Minimal allocations, reuses string buffers where possible - <strong>Comprehensive parsing</strong>: Preserves complex CSS structures including nested media queries, nested selectors, data URIs, CSS functions (calc(), var(), etc.)</p>

<h2 id="label-Development+Notes">Development Notes</h2>

<p>Significant portions of this codebase were generated with assistance from <a href="https://claude.com/claude-code">Claude Code</a>, including the benchmark infrastructure, test suite, and documentation generation system.</p>

<h2 id="label-License">License</h2>

<p>MIT</p>

<h2 id="label-Contributing">Contributing</h2>

<p>Bug reports and pull requests are welcome on GitHub at <a href="https://github.com/jamescook/cataract">github.com/jamescook/cataract</a>.</p>
</div></div>

      <div id="footer">
  Generated on Mon Nov 10 00:31:27 2025 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.37 (ruby-3.4.7).
</div>

    </div>
  </body>
</html>