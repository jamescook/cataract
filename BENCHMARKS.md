<!-- AUTO-GENERATED FILE - DO NOT EDIT -->
<!-- This file is automatically generated from benchmark results. -->
<!-- To regenerate: rake benchmark:generate_docs -->

# Performance Benchmarks

Comprehensive performance comparison between Cataract and css_parser gem.

## Test Environment

- **Ruby**: ruby 3.4.5 (2025-07-16 revision 20cda200d3) +YJIT +PRISM [arm64-darwin23]
- **CPU**: Apple M1 Pro
- **Memory**: 32GB
- **OS**: macOS 14.5
- **Generated**: 2025-10-30T16:01:15-05:00

<details>
<summary><h2>Premailer Integration</h2></summary>

Drop-in replacement performance for Premailer email CSS inlining.


| Parser | Speed | Time per operation |
|--------|-------|-------------------|
| css_parser | 122.6 i/s | 8.16 ms |
| **Cataract** | **2.71K i/s** | **369.63 μs** |
| **Speedup** | **22.07x faster** | |

### Key Takeaways
- Cataract provides **22.07x faster** CSS inlining for email templates
- Drop-in replacement for Premailer with zero code changes
- Zero code changes required - just call `Cataract.mimic_CssParser!`

</details>

---

<details>
<summary><h2>CSS Parsing</h2></summary>

Performance of parsing CSS into internal data structures.

Time to parse CSS into internal data structures

### Small CSS (64 lines, 1.0KB)


| Parser | Speed | Time per operation |
|--------|-------|-------------------|
| css_parser | 6.22K i/s | 160.8 μs |
| **Cataract** | **68.67K i/s** | **14.56 μs** |
| **Speedup** | **11.04x faster** | |

### Medium CSS with @media (139 lines, 1.6KB)


| Parser | Speed | Time per operation |
|--------|-------|-------------------|
| css_parser | 3.49K i/s | 286.42 μs |
| **Cataract** | **44.78K i/s** | **22.33 μs** |
| **Speedup** | **12.83x faster** | |


</details>

---

<details>
<summary><h2>CSS Serialization (to_s)</h2></summary>

Performance of converting parsed CSS back to string format.

Time to convert parsed CSS back to string format

### Full Serialization (Bootstrap CSS - 191KB)


| Parser | Speed | Time per operation |
|--------|-------|-------------------|
| css_parser | 34.5 i/s | 29.01 ms |
| **Cataract** | **687.1 i/s** | **1.46 ms** |
| **Speedup** | **19.93x faster** | |

### Media Type Filtering (print only)


| Parser | Speed | Time per operation |
|--------|-------|-------------------|
| css_parser | 3.95K i/s | 253.4 μs |
| **Cataract** | **51.11K i/s** | **19.57 μs** |
| **Speedup** | **12.95x faster** | |


</details>

---

<details>
<summary><h2>Specificity Calculation</h2></summary>

Performance of calculating CSS selector specificity values.

Time to calculate CSS selector specificity values

| Test Case | Speedup |
|-----------|---------|
| Simple Selectors | **21.09x faster** |
| Compound Selectors | **30.83x faster** |
| Combinators | **28.28x faster** |
| Pseudo-classes & Pseudo-elements | **45.73x faster** |
| :not() Pseudo-class (CSS3) | **23.61x faster** |
| Complex Real-world Selectors | **48.9x faster** |

**Summary:** 21.09x faster to 48.9x faster (avg 33.07x faster)

</details>

---

<details>
<summary><h2>CSS Merging</h2></summary>

Performance of merging multiple CSS rule sets with the same selector.

Time to merge multiple CSS rule sets with same selector

| Test Case | Speedup |
|-----------|---------|
| Simple properties | **2.86x faster** |
| Cascade with specificity | **4.12x faster** |
| Important declarations | **4.36x faster** |
| Shorthand expansion | **3.06x faster** |
| Complex merging | **2.38x faster** |

**Summary:** 2.38x faster to 4.36x faster (avg 3.36x faster)

### What's Being Tested
- Specificity-based CSS cascade (ID > class > element)
- `!important` declaration handling
- Shorthand property expansion (e.g., `margin` → `margin-top`, `margin-right`, etc.)
- Shorthand property creation from longhand properties

</details>

---

<details>
<summary><h2>YJIT Impact</h2></summary>

Impact of Ruby's YJIT JIT compiler on Ruby-side operations. The C extension performance is the same regardless of YJIT.

Ruby-side operations with and without YJIT

### Operations Per Second

| Operation | Without YJIT | With YJIT | YJIT Improvement |
|-----------|--------------|-----------|------------------|
| property access | 225.44K i/s | 307.69K i/s | **1.36x faster** (36% faster) |
| declaration merging | 192.53K i/s | 319.51K i/s | **1.66x faster** (66% faster) |
| to_s generation | 239.35K i/s | 367.52K i/s | **1.54x faster** (54% faster) |
| parse + iterate | 89.54K i/s | 105.91K i/s | **1.18x faster** (18% faster) |

### Key Takeaways
- YJIT provides significant performance boost for Ruby-side operations
- Greatest impact on declaration merging
- Parse + iterate benefits least since most work is in C
- Recommended: Enable YJIT in production (`--yjit` flag or `RUBY_YJIT_ENABLE=1`)

</details>

---

## Summary

### Performance Highlights

| Category | Min Speedup | Max Speedup | Avg Speedup |
|----------|-------------|-------------|-------------|
| **Parsing** | 11.04x faster | 12.83x faster | 11.93x faster |
| **Serialization** | 12.95x faster | 19.93x faster | 16.44x faster |
| **Specificity** | 21.09x faster | 48.9x faster | 33.07x faster |
| **Merging** | 2.38x faster | 4.36x faster | 3.36x faster |

### Implementation Notes

1. **C Extension**: Critical paths (parsing, specificity, merging, serialization) implemented in C
2. **Efficient Data Structures**: Rules grouped by media query for O(1) lookups
3. **Memory Efficient**: Pre-allocated string buffers, minimal Ruby object allocations
4. **Optimized Algorithms**: Purpose-built CSS specificity calculator

### Use Cases

- **Email inlining** (Premailer): Drop-in replacement for css_parser
- **Large CSS files**: Handles complex stylesheets efficiently
- **Specificity calculations**: Optimized for selector analysis
- **High-volume processing**: Reduced allocations minimize GC pressure
- **Production applications**: Tested with Bootstrap CSS and real-world stylesheets

---

## Running Benchmarks

```bash
# All benchmarks
rake benchmark 2>&1 | tee benchmark_output.txt

# Individual benchmarks
rake benchmark:parsing
rake benchmark:serialization
rake benchmark:specificity
rake benchmark:merging
rake benchmark:premailer
rake benchmark:yjit

# Generate documentation
rake benchmark:generate_docs
```

## Notes

- All benchmarks use benchmark-ips with 3s warmup and 5-10s measurement periods
- Measurements are median i/s (iterations per second) with standard deviation
- css_parser gem must be installed for comparison benchmarks
- Premailer benchmark requires premailer gem
