<!-- AUTO-GENERATED FILE - DO NOT EDIT -->
<!-- This file is automatically generated from benchmark results. -->
<!-- To regenerate: rake benchmark:generate_docs -->

# Performance Benchmarks

Comprehensive performance comparison between Cataract and css_parser gem.

## Test Environment

- **Ruby**: ruby 3.4.5 (2025-07-16 revision 20cda200d3) +YJIT +PRISM [arm64-darwin23]
- **CPU**: Apple M1 Pro
- **Memory**: 32GB
- **OS**: macOS 14.5
- **Generated**: 2025-10-30T16:01:15-05:00

<details>
<summary><h2>Premailer Integration</h2></summary>

Drop-in replacement performance for Premailer email CSS inlining.


| Parser | Speed | Time per operation |
|--------|-------|-------------------|
| css_parser | 122.9 i/s | 8.13 ms |
| **Cataract** | **2.57K i/s** | **388.86 μs** |
| **Speedup** | **20.92x faster** | |

### Key Takeaways
- Cataract provides **20.92x faster** CSS inlining for email templates
- Drop-in replacement for Premailer with zero code changes
- Zero code changes required - just call `Cataract.mimic_CssParser!`

</details>

---

<details>
<summary><h2>CSS Parsing</h2></summary>

Performance of parsing CSS into internal data structures.

Time to parse CSS into internal data structures

### Small CSS (64 lines, 1.0KB)


| Parser | Speed | Time per operation |
|--------|-------|-------------------|
| css_parser | 6.25K i/s | 160.07 μs |
| **Cataract** | **67.74K i/s** | **14.76 μs** |
| **Speedup** | **10.84x faster** | |

### Medium CSS with @media (139 lines, 1.6KB)


| Parser | Speed | Time per operation |
|--------|-------|-------------------|
| css_parser | 3.44K i/s | 290.31 μs |
| **Cataract** | **44.04K i/s** | **22.71 μs** |
| **Speedup** | **12.79x faster** | |


</details>

---

<details>
<summary><h2>CSS Serialization (to_s)</h2></summary>

Performance of converting parsed CSS back to string format.

Time to convert parsed CSS back to string format

### Full Serialization (Bootstrap CSS - 191KB)


| Parser | Speed | Time per operation |
|--------|-------|-------------------|
| css_parser | 34.1 i/s | 29.3 ms |
| **Cataract** | **675.9 i/s** | **1.48 ms** |
| **Speedup** | **19.81x faster** | |

### Media Type Filtering (print only)


| Parser | Speed | Time per operation |
|--------|-------|-------------------|
| css_parser | 3.84K i/s | 260.38 μs |
| **Cataract** | **216.54K i/s** | **4.62 μs** |
| **Speedup** | **56.38x faster** | |


</details>

---

<details>
<summary><h2>Specificity Calculation</h2></summary>

Performance of calculating CSS selector specificity values.

Time to calculate CSS selector specificity values

| Test Case | Speedup |
|-----------|---------|
| Simple Selectors | **21.19x faster** |
| Compound Selectors | **30.45x faster** |
| Combinators | **28.63x faster** |
| Pseudo-classes & Pseudo-elements | **45.45x faster** |
| :not() Pseudo-class (CSS3) | **23.52x faster** |
| Complex Real-world Selectors | **49.29x faster** |

**Summary:** 21.19x faster to 49.29x faster (avg 33.09x faster)

</details>

---

<details>
<summary><h2>CSS Merging</h2></summary>

Performance of merging multiple CSS rule sets with the same selector.

Time to merge multiple CSS rule sets with same selector

| Test Case | Speedup |
|-----------|---------|
| Simple properties | **2.79x faster** |
| Cascade with specificity | **4.05x faster** |
| Important declarations | **4.24x faster** |
| Shorthand expansion | **3.02x faster** |
| Complex merging | **2.31x faster** |

**Summary:** 2.31x faster to 4.24x faster (avg 3.28x faster)

### What's Being Tested
- Specificity-based CSS cascade (ID > class > element)
- `!important` declaration handling
- Shorthand property expansion (e.g., `margin` → `margin-top`, `margin-right`, etc.)
- Shorthand property creation from longhand properties

</details>

---

<details>
<summary><h2>YJIT Impact</h2></summary>

Impact of Ruby's YJIT JIT compiler on Ruby-side operations. The C extension performance is the same regardless of YJIT.

Ruby-side operations with and without YJIT

### Operations Per Second

| Operation | Without YJIT | With YJIT | YJIT Improvement |
|-----------|--------------|-----------|------------------|
| property access | 220.91K i/s | 310.69K i/s | **1.41x faster** (41% faster) |
| declaration merging | 195.44K i/s | 317.55K i/s | **1.62x faster** (62% faster) |
| to_s generation | 231.39K i/s | 374.58K i/s | **1.62x faster** (62% faster) |
| parse + iterate | 85.71K i/s | 103.7K i/s | **1.21x faster** (21% faster) |

### Key Takeaways
- YJIT provides significant performance boost for Ruby-side operations
- Greatest impact on declaration merging
- Parse + iterate benefits least since most work is in C
- Recommended: Enable YJIT in production (`--yjit` flag or `RUBY_YJIT_ENABLE=1`)

</details>

---

## Summary

### Performance Highlights

| Category | Min Speedup | Max Speedup | Avg Speedup |
|----------|-------------|-------------|-------------|
| **Parsing** | 10.84x faster | 12.79x faster | 11.81x faster |
| **Serialization** | 19.81x faster | 56.38x faster | 38.09x faster |
| **Specificity** | 21.19x faster | 49.29x faster | 33.09x faster |
| **Merging** | 2.31x faster | 4.24x faster | 3.28x faster |

### Implementation Notes

1. **C Extension**: Critical paths (parsing, specificity, merging, serialization) implemented in C
2. **Efficient Data Structures**: Rules grouped by media query for O(1) lookups
3. **Memory Efficient**: Pre-allocated string buffers, minimal Ruby object allocations
4. **Optimized Algorithms**: Purpose-built CSS specificity calculator

### Use Cases

- **Email inlining** (Premailer): Drop-in replacement for css_parser
- **Large CSS files**: Handles complex stylesheets efficiently
- **Specificity calculations**: Optimized for selector analysis
- **High-volume processing**: Reduced allocations minimize GC pressure
- **Production applications**: Tested with Bootstrap CSS and real-world stylesheets

---

## Running Benchmarks

```bash
# All benchmarks
rake benchmark 2>&1 | tee benchmark_output.txt

# Individual benchmarks
rake benchmark:parsing
rake benchmark:serialization
rake benchmark:specificity
rake benchmark:merging
rake benchmark:yjit

# Generate documentation
rake benchmark:generate_docs
```

## Notes

- All benchmarks use benchmark-ips with 3s warmup and 5-10s measurement periods
- Measurements are median i/s (iterations per second) with standard deviation
- css_parser gem must be installed for comparison benchmarks
